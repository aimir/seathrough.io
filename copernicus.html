<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <!--
     ArcGIS API for JavaScript, https://js.arcgis.com
     For more information about the widgets-timeslider sample,
     read the original sample description at developers.arcgis.com.
     https://developers.arcgis.com/javascript/latest/sample-code/widgets-timeslider/index.html
     -->
    <title>Copernicus Data Viewer</title>
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.24/esri/themes/dark/main.css"
    />
    <script type="text/javascript" src="jsdap-8.1.0.js"></script>
    <script src='https://cdn.plot.ly/plotly-2.12.1.min.js'></script>
    <script src="/overrides/js.arcgis.com/4.24/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      #timeSlider {
        position: absolute;
        left: 5%;
        right: 5%;
        bottom: 20px;
      }
      #layerToggle {
        top: 15px;
        right: 60px;
        position: absolute;
        z-index: 99;
        border-radius: 8px;
        padding-top: 5px;
        padding-right: 8px;
        padding-bottom: 5px;
        padding-left: 2px;
        opacity: 0.85;
      }
      .esri-view-width-xlarge .esri-popup__main-container,
      .esri-view-width-large .esri-popup__main-container,
      .esri-view-width-medium .esri-popup__main-container
      {
        width: 550px !important;
      }‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍
    </style>
    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/WMSLayer",
        "esri/widgets/TimeSlider",
        "esri/widgets/Legend",
        "esri/widgets/Expand",
        "esri/layers/ImageryTileLayer",
        "esri/geometry/Point",
        "esri/layers/MediaLayer",
        "esri/layers/support/ImageElement",
        "esri/layers/support/CornersGeoreference",
        "esri/widgets/Legend/LegendViewModel",
      ], function (Map, MapView, WMSLayer, TimeSlider, Legend, Expand, ImageryTileLayer, Point, MediaLayer, ImageElement, CornersGeoreference, LegendViewModel) {
        var url = new URL(window.location);
        let param = url.searchParams.get('param');
        if (!["VHM0", "VTPK", "VTM10", "VTM02", "VMDR", "VHM0_WW", "VTM01_WW", "VMDR_WW", "VPED", "VHM0_SW1", "VTM01_SW1", "VMDR_SW1", "VHM0_SW2", "VTM01_SW2", "VMDR_SW2", "VSDX", "VSDY"].contains(param)) {
          param = "VHM0";
        }
        let title = {
          latitude: "latitude",
          longitude: "longitude",
          time: "time",
          VHM0: "Spectral significant wave height (Hm0)",
          VTPK: "Wave period at spectral peak / peak period (Tp)",
          VTM10: "Spectral moments (-1,0) wave period (Tm-10)",
          VTM02: "Spectral moments (0,2) wave period (Tm02)",
          VMDR: "Mean wave direction from (Mdir)",
          VHM0_WW: "Spectral significant wind wave height",
          VTM01_WW: "Spectral moments (0,1) wind wave period",
          VMDR_WW: "Mean wind wave direction from",
          VPED: "Wave principal direction at spectral peak",
          VHM0_SW1: "Spectral significant primary swell wave height",
          VTM01_SW1: "Spectral moments (0,1) primary swell wave period",
          VMDR_SW1: "Mean primary swell wave direction from",
          VHM0_SW2: "Spectral significant secondary swell wave height",
          VTM01_SW2: "Spectral moments (0,1) secondary swell wave period",
          VMDR_SW2: "Mean secondary swell wave direction from",
          VSDX: "Stokes drift U",
          VSDY: "Stokes drift V",
        }[param];
        let scale_factor = {
          latitude: 1,
          longitude: 1,
          time: 1,
          VHM0: 0.001,
          VTPK: 0.001,
          VTM10: 0.001,
          VTM02: 0.001,
          VMDR: 0.01,
          VHM0_WW: 0.001,
          VTM01_WW: 0.001,
          VMDR_WW: 0.01,
          VPED: 0.01,
          VHM0_SW1: 0.001,
          VTM01_SW1: 0.001,
          VMDR_SW1: 0.01,
          VHM0_SW2: 0.001,
          VTM01_SW2: 0.001,
          VMDR_SW2: 0.01,
          VSDX: 0.001,
          VSDY: 0.001,
        }[param];
        let add_offset = {
          latitude: 0.0,
          longitude: 0.0,
          time: 0.0,
          VHM0: 0.0,
          VTPK: 0.0,
          VTM10: 0.0,
          VTM02: 0.0,
          VMDR: 180.0,
          VHM0_WW: 0.0,
          VTM01_WW: 0.0,
          VMDR_WW: 180.0,
          VPED: 180.0,
          VHM0_SW1: 0.0,
          VTM01_SW1: 0.0,
          VMDR_SW1: 180.0,
          VHM0_SW2: 0.0,
          VTM01_SW2: 0.0,
          VMDR_SW2: 180.0,
          VSDX: 0.0,
          VSDY: 0.0,
        }[param];
        let units = {
          latitude: '',
          longitude: '',
          time: '',
          VHM0: 'm',
          VTPK: 's',
          VTM10: 's',
          VTM02: 's',
          VMDR: 'degree',
          VHM0_WW: 'm',
          VTM01_WW: 's',
          VMDR_WW: 'degree',
          VPED: 'degree',
          VHM0_SW1: 'm',
          VTM01_SW1: 's',
          VMDR_SW1: 'degree',
          VHM0_SW2: 'm',
          VTM01_SW2: 's',
          VMDR_SW2: 'degree',
          VSDX: 'm/s',
          VSDY: 'm/s',
        }[param];
        var layer = new WMSLayer({
          url: "https://my.cmems-du.eu/thredds/wms/med-hcmr-wav-rean-h",
          sublayers: [
            {
              name: param,
              title: title,
              legendUrl: "http://my.cmems-du.eu/thredds/wms/med-hcmr-wav-rean-h?REQUEST=GetLegendGraphic&LAYER=" + param + "&PALETTE=alg",
            },
          ],
          customParameters: {
            "styles": "boxfill/alg",
          },
          visible: false,
        });
        var layer2 = new WMSLayer({
          url: "https://my.cmems-du.eu/thredds/wms/cmems_mod_med_wav_myint_4.2km_PT1H-i",
          sublayers: [
            {
              name: param,
              title: title,
              legendUrl: "http://my.cmems-du.eu/thredds/wms/cmems_mod_med_wav_myint_4.2km_PT1H-i?REQUEST=GetLegendGraphic&LAYER=" + param + "&PALETTE=alg",
            },
          ],
          customParameters: {
            "styles": "boxfill/alg",
          },
          visible: false,
        });
        let layers = [];
        for(let year=1993; year <= 2020; year++) {
          for(let month=1; month <= 12; month++) {
            const image = new ImageElement({
              image: "/vars/" + param + "/" + year + '_' + (month<10?'0':'') + month + '.png',
              georeference: new CornersGeoreference({
                bottomRight: new Point({
                  x: 36.31250190734863,
                  y: 30.16666,
                  spatialReference: {
                    wkid: 4326
                  }
                }),
                bottomLeft: new Point({
                  x: -18.145833015441895,
                  y: 30.16666,
                  spatialReference: {
                    wkid: 4326
                  }
                }),
                topRight: new Point({
                  x: 36.31250190734863,
                  y: 46.00000,
                  spatialReference: {
                    wkid: 4326
                  }
                }),
                topLeft: new Point({
                  x: -18.145833015441895,
                  y: 46.00000,
                  spatialReference: {
                    wkid: 4326
                  }
                })
              })
            });
            layers = layers.concat(new MediaLayer({
              source: [image],
              title: param,
              visible: (year == 1993 && month == 1),
            }));
          }
        }
        /*const layer3 = new ImageryTileLayer({
          url: "https://amirsar.id/imageserver",
          title: "World Elevation ImageryTileLayer",
          legendUrl: "http://my.cmems-du.eu/thredds/wms/med-hcmr-wav-rean-h?REQUEST=GetLegendGraphic&LAYER=VHM0&PALETTE=alg",
          resampling: true,
          interpolation: "nearest",
          visible: false,
        });
        layer.await();
        layer2.await();
        layer3.await();*/
        const map = new Map({
          basemap: "hybrid",
          layers: [layer, layer2].concat(layers),
        });
        const view = new MapView({
          map: map,
          container: "viewDiv",
          zoom: 7,
          center: [34, 32.5],
          popup: {
            content: '<div></div>',
            autoOpenEnabled: false,
            dockOptions: {
              buttonEnabled: false
            }
          }
        });
        const legend = new Legend({
          view: view,
          viewModel: new LegendViewModel({
            view: view,
            layerInfos: [
              {
                layer: layer,
                title: param,
              },
            ],
          }),
        });
        const legendExpand = new Expand({
          view: view,
          content: legend,
        });
        // Add widget to the bottom right corner of the view
        view.ui.add(legendExpand, "top-right");
        view.when(() => {
          layer.when(() => {
            layer2.when(() => {
              hourly = {count: (layer2.timeInfo.fullTimeExtent.end - layer.timeInfo.fullTimeExtent.start) / 1000 / 60 / 60};
              let dates = [];
              for(let year=layer.timeInfo.fullTimeExtent.start.getUTCFullYear(); year <= layer2.timeInfo.fullTimeExtent.end.getUTCFullYear(); year++) {
                for(let month=1; month <= 12; month++) {
                  let month_start = new Date(year + '-' + (month<10?'0':'') + month + '-01T00:00:00Z');
                  let month_end = new Date((month==12?year+1:year) + '-' + ((month%12+1)<10?'0':'') + (month%12+1) + '-01T00:00:00Z') - 60 * 60 * 1000;
                  if (layer.timeInfo.fullTimeExtent.start <= month_start && month_end <= layer2.timeInfo.fullTimeExtent.end) {
                    dates = dates.concat(month_start);
                  }
                }
              }
              monthly = {
                dates: dates
              }
              // time slider widget initialization
              const timeSlider = new TimeSlider({
                container: "timeSlider",
                view: view,
                mode: "instant",
                timeVisible: true, // show the time stamps on the timeslider
                fullTimeExtent: {
                  start: layer.timeInfo.fullTimeExtent.start,
                  end: layer2.timeInfo.fullTimeExtent.end,
                },
                stops: monthly,
                playRate: 5000,
              });
              timeSlider.watch("timeExtent", (timeExtent) => {
                if (layer.timeInfo.fullTimeExtent.start <= timeExtent.start && timeExtent.start <= layer.timeInfo.fullTimeExtent.end) {
                  layer.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer.visible = false;
                }
                if (layer2.timeInfo.fullTimeExtent.start <= timeExtent.start && timeExtent.start <= layer2.timeInfo.fullTimeExtent.end) {
                  layer2.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer2.visible = false;
                }
                if(document.getElementById("hourly").checked) {
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = false;
                  });
                }
                else {
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = (dates[index] <= timeSlider.timeExtent.start) && (timeSlider.timeExtent.start < dates[index + 1]);
                  });
                }
              });
              document.getElementById("monthly").onclick=function() {
                if (layer.timeInfo.fullTimeExtent.start <= timeSlider.timeExtent.start && timeSlider.timeExtent.start <= layer.timeInfo.fullTimeExtent.end) {
                  layer.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer.visible = false;
                }
                if (layer2.timeInfo.fullTimeExtent.start <= timeSlider.timeExtent.start && timeSlider.timeExtent.start <= layer2.timeInfo.fullTimeExtent.end) {
                  layer2.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer2.visible = false;
                }
                if(document.getElementById("hourly").checked) {
                  timeSlider.stops = hourly;
                  timeSlider.playRate = 1000;
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = false;
                  });
                }
                else {
                  timeSlider.stops = monthly;
                  timeSlider.playRate = 5000;
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = (dates[index] <= timeSlider.timeExtent.start) && (timeSlider.timeExtent.start < dates[index + 1]);
                  });
                }
              };
              document.getElementById("hourly").onclick=function() {
                if (layer.timeInfo.fullTimeExtent.start <= timeSlider.timeExtent.start && timeSlider.timeExtent.start <= layer.timeInfo.fullTimeExtent.end) {
                  layer.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer.visible = false;
                }
                if (layer2.timeInfo.fullTimeExtent.start <= timeSlider.timeExtent.start && timeSlider.timeExtent.start <= layer2.timeInfo.fullTimeExtent.end) {
                  layer2.visible = document.getElementById("hourly").checked;
                }
                else {
                  layer2.visible = false;
                }
                if(document.getElementById("hourly").checked) {
                  timeSlider.stops = hourly;
                  timeSlider.playRate = 1000;
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = false;
                  });
                }
                else {
                  timeSlider.stops = monthly;
                  timeSlider.playRate = 5000;
                  layers.forEach(function(curr_layer, index) {
                    curr_layer.visible = (dates[index] <= timeSlider.timeExtent.start) && (timeSlider.timeExtent.start < dates[index + 1]);
                  });
                }
              };
              view.on("click", (event) => {
                const argFact = (compareFn) => (array) => array.map((el, idx) => [el, idx]).reduce(compareFn)[1];
                const argMin = argFact((max, el) => (el[0] < max[0] ? el : max));
                const lats = [30.1875, 30.229166, 30.270834, 30.3125, 30.354166, 30.395834, 30.4375, 30.479166, 30.520834, 30.5625, 30.604166, 30.645834, 30.6875, 30.729166, 30.770834, 30.8125, 30.854166, 30.895834, 30.9375, 30.979166, 31.020834, 31.0625, 31.104166, 31.145834, 31.1875, 31.229166, 31.270834, 31.3125, 31.354166, 31.395834, 31.4375, 31.479166, 31.520834, 31.5625, 31.604166, 31.645834, 31.6875, 31.729166, 31.770834, 31.8125, 31.854166, 31.895834, 31.9375, 31.979166, 32.020832, 32.0625, 32.104168, 32.145832, 32.1875, 32.229168, 32.270832, 32.3125, 32.354168, 32.395832, 32.4375, 32.479168, 32.520832, 32.5625, 32.604168, 32.645832, 32.6875, 32.729168, 32.770832, 32.8125, 32.854168, 32.895832, 32.9375, 32.979168, 33.020832, 33.0625, 33.104168, 33.145832, 33.1875, 33.229168, 33.270832, 33.3125, 33.354168, 33.395832, 33.4375, 33.479168, 33.520832, 33.5625, 33.604168, 33.645832, 33.6875, 33.729168, 33.770832, 33.8125, 33.854168, 33.895832, 33.9375, 33.979168, 34.020832, 34.0625, 34.104168, 34.145832, 34.1875, 34.229168, 34.270832, 34.3125, 34.354168, 34.395832, 34.4375, 34.479168, 34.520832, 34.5625, 34.604168, 34.645832, 34.6875, 34.729168, 34.770832, 34.8125, 34.854168, 34.895832, 34.9375, 34.979168, 35.020832, 35.0625, 35.104168, 35.145832, 35.1875, 35.229168, 35.270832, 35.3125, 35.354168, 35.395832, 35.4375, 35.479168, 35.520832, 35.5625, 35.604168, 35.645832, 35.6875, 35.729168, 35.770832, 35.8125, 35.854168, 35.895832, 35.9375, 35.979168, 36.020832, 36.0625, 36.104168, 36.145832, 36.1875, 36.229168, 36.270832, 36.3125, 36.354168, 36.395832, 36.4375, 36.479168, 36.520832, 36.5625, 36.604168, 36.645832, 36.6875, 36.729168, 36.770832, 36.8125, 36.854168, 36.895832, 36.9375, 36.979168, 37.020832, 37.0625, 37.104168, 37.145832, 37.1875, 37.229168, 37.270832, 37.3125, 37.354168, 37.395832, 37.4375, 37.479168, 37.520832, 37.5625, 37.604168, 37.645832, 37.6875, 37.729168, 37.770832, 37.8125, 37.854168, 37.895832, 37.9375, 37.979168, 38.020832, 38.0625, 38.104168, 38.145832, 38.1875, 38.229168, 38.270832, 38.3125, 38.354168, 38.395832, 38.4375, 38.479168, 38.520832, 38.5625, 38.604168, 38.645832, 38.6875, 38.729168, 38.770832, 38.8125, 38.854168, 38.895832, 38.9375, 38.979168, 39.020832, 39.0625, 39.104168, 39.145832, 39.1875, 39.229168, 39.270832, 39.3125, 39.354168, 39.395832, 39.4375, 39.479168, 39.520832, 39.5625, 39.604168, 39.645832, 39.6875, 39.729168, 39.770832, 39.8125, 39.854168, 39.895832, 39.9375, 39.979168, 40.020832, 40.0625, 40.104168, 40.145832, 40.1875, 40.229168, 40.270832, 40.3125, 40.354168, 40.395832, 40.4375, 40.479168, 40.520832, 40.5625, 40.604168, 40.645832, 40.6875, 40.729168, 40.770832, 40.8125, 40.854168, 40.895832, 40.9375, 40.979168, 41.020832, 41.0625, 41.104168, 41.145832, 41.1875, 41.229168, 41.270832, 41.3125, 41.354168, 41.395832, 41.4375, 41.479168, 41.520832, 41.5625, 41.604168, 41.645832, 41.6875, 41.729168, 41.770832, 41.8125, 41.854168, 41.895832, 41.9375, 41.979168, 42.020832, 42.0625, 42.104168, 42.145832, 42.1875, 42.229168, 42.270832, 42.3125, 42.354168, 42.395832, 42.4375, 42.479168, 42.520832, 42.5625, 42.604168, 42.645832, 42.6875, 42.729168, 42.770832, 42.8125, 42.854168, 42.895832, 42.9375, 42.979168, 43.020832, 43.0625, 43.104168, 43.145832, 43.1875, 43.229168, 43.270832, 43.3125, 43.354168, 43.395832, 43.4375, 43.479168, 43.520832, 43.5625, 43.604168, 43.645832, 43.6875, 43.729168, 43.770832, 43.8125, 43.854168, 43.895832, 43.9375, 43.979168, 44.020832, 44.0625, 44.104168, 44.145832, 44.1875, 44.229168, 44.270832, 44.3125, 44.354168, 44.395832, 44.4375, 44.479168, 44.520832, 44.5625, 44.604168, 44.645832, 44.6875, 44.729168, 44.770832, 44.8125, 44.854168, 44.895832, 44.9375, 44.979168, 45.020832, 45.0625, 45.104168, 45.145832, 45.1875, 45.229168, 45.270832, 45.3125, 45.354168, 45.395832, 45.4375, 45.479168, 45.520832, 45.5625, 45.604168, 45.645832, 45.6875, 45.729168, 45.770832, 45.8125, 45.854168, 45.895832, 45.9375, 45.979168];
                const longs = [-18.125, -18.083334, -18.041666, -18.0, -17.958334, -17.916666, -17.875, -17.833334, -17.791666, -17.75, -17.708334, -17.666666, -17.625, -17.583334, -17.541666, -17.5, -17.458334, -17.416666, -17.375, -17.333334, -17.291666, -17.25, -17.208334, -17.166666, -17.125, -17.083334, -17.041666, -17.0, -16.958334, -16.916666, -16.875, -16.833334, -16.791666, -16.75, -16.708334, -16.666666, -16.625, -16.583334, -16.541666, -16.5, -16.458334, -16.416666, -16.375, -16.333334, -16.291666, -16.25, -16.208334, -16.166666, -16.125, -16.083334, -16.041666, -16.0, -15.958333, -15.916667, -15.875, -15.833333, -15.791667, -15.75, -15.708333, -15.666667, -15.625, -15.583333, -15.541667, -15.5, -15.458333, -15.416667, -15.375, -15.333333, -15.291667, -15.25, -15.208333, -15.166667, -15.125, -15.083333, -15.041667, -15.0, -14.958333, -14.916667, -14.875, -14.833333, -14.791667, -14.75, -14.708333, -14.666667, -14.625, -14.583333, -14.541667, -14.5, -14.458333, -14.416667, -14.375, -14.333333, -14.291667, -14.25, -14.208333, -14.166667, -14.125, -14.083333, -14.041667, -14.0, -13.958333, -13.916667, -13.875, -13.833333, -13.791667, -13.75, -13.708333, -13.666667, -13.625, -13.583333, -13.541667, -13.5, -13.458333, -13.416667, -13.375, -13.333333, -13.291667, -13.25, -13.208333, -13.166667, -13.125, -13.083333, -13.041667, -13.0, -12.958333, -12.916667, -12.875, -12.833333, -12.791666, -12.75, -12.708333, -12.666666, -12.625, -12.583333, -12.541666, -12.5, -12.458333, -12.416666, -12.375, -12.333333, -12.291666, -12.25, -12.208333, -12.166666, -12.125, -12.083333, -12.041666, -12.0, -11.958333, -11.916666, -11.875, -11.833333, -11.791666, -11.75, -11.708333, -11.666666, -11.625, -11.583333, -11.541666, -11.5, -11.458333, -11.416666, -11.375, -11.333333, -11.291666, -11.25, -11.208333, -11.166666, -11.125, -11.083333, -11.041666, -11.0, -10.958333, -10.916666, -10.875, -10.833333, -10.791666, -10.75, -10.708333, -10.666666, -10.625, -10.583333, -10.541666, -10.5, -10.458333, -10.416666, -10.375, -10.333333, -10.291666, -10.25, -10.208333, -10.166666, -10.125, -10.083333, -10.041666, -10.0, -9.958333, -9.916666, -9.875, -9.833333, -9.791666, -9.75, -9.708333, -9.666666, -9.625, -9.583333, -9.541666, -9.5, -9.458333, -9.416666, -9.375, -9.333333, -9.291666, -9.25, -9.208333, -9.166666, -9.125, -9.083333, -9.041666, -9.0, -8.958333, -8.916666, -8.875, -8.833333, -8.791666, -8.75, -8.708333, -8.666666, -8.625, -8.583333, -8.541666, -8.5, -8.458333, -8.416666, -8.375, -8.333333, -8.291666, -8.25, -8.208333, -8.166666, -8.125, -8.083333, -8.041666, -7.9999995, -7.958333, -7.9166665, -7.8749995, -7.833333, -7.7916665, -7.7499995, -7.708333, -7.6666665, -7.6249995, -7.583333, -7.5416665, -7.4999995, -7.458333, -7.4166665, -7.3749995, -7.333333, -7.2916665, -7.2499995, -7.208333, -7.1666665, -7.1249995, -7.083333, -7.0416665, -6.9999995, -6.958333, -6.9166665, -6.8749995, -6.833333, -6.7916665, -6.7499995, -6.708333, -6.6666665, -6.6249995, -6.583333, -6.5416665, -6.4999995, -6.458333, -6.4166665, -6.3749995, -6.333333, -6.2916665, -6.2499995, -6.208333, -6.1666665, -6.1249995, -6.083333, -6.0416665, -5.9999995, -5.958333, -5.9166665, -5.8749995, -5.833333, -5.7916665, -5.7499995, -5.708333, -5.6666665, -5.6249995, -5.583333, -5.5416665, -5.4999995, -5.458333, -5.4166665, -5.3749995, -5.333333, -5.2916665, -5.2499995, -5.208333, -5.1666665, -5.1249995, -5.083333, -5.0416665, -4.9999995, -4.958333, -4.9166665, -4.8749995, -4.833333, -4.791666, -4.7499995, -4.708333, -4.666666, -4.6249995, -4.583333, -4.541666, -4.4999995, -4.458333, -4.416666, -4.3749995, -4.333333, -4.291666, -4.2499995, -4.208333, -4.166666, -4.1249995, -4.083333, -4.041666, -3.9999995, -3.958333, -3.9166663, -3.8749995, -3.833333, -3.7916663, -3.7499995, -3.708333, -3.6666663, -3.6249995, -3.583333, -3.5416663, -3.4999995, -3.458333, -3.4166663, -3.3749995, -3.3333328, -3.2916663, -3.2499995, -3.2083328, -3.1666663, -3.1249995, -3.0833328, -3.0416663, -2.9999995, -2.9583328, -2.9166663, -2.8749995, -2.8333328, -2.7916663, -2.7499995, -2.7083328, -2.6666663, -2.6249995, -2.5833328, -2.5416663, -2.4999995, -2.4583328, -2.4166663, -2.3749995, -2.3333328, -2.2916663, -2.2499995, -2.2083328, -2.1666663, -2.1249995, -2.0833328, -2.0416663, -1.9999995, -1.9583329, -1.9166662, -1.8749995, -1.8333329, -1.7916662, -1.7499995, -1.7083329, -1.6666662, -1.6249995, -1.5833329, -1.5416662, -1.4999995, -1.4583328, -1.4166662, -1.3749995, -1.3333328, -1.2916662, -1.2499995, -1.2083328, -1.1666662, -1.1249995, -1.0833328, -1.0416662, -0.99999946, -0.95833284, -0.91666615, -0.87499946, -0.83333284, -0.79166615, -0.74999946, -0.70833284, -0.66666615, -0.62499946, -0.58333284, -0.54166615, -0.49999946, -0.4583328, -0.41666615, -0.37499946, -0.3333328, -0.29166615, -0.24999946, -0.2083328, -0.16666614, -0.12499946, -0.08333279, -0.041666128, 5.401671e-07, 0.041667208, 0.08333388, 0.12500054, 0.16666721, 0.20833388, 0.25000054, 0.29166722, 0.33333388, 0.37500054, 0.41666722, 0.45833388, 0.50000054, 0.5416672, 0.5833339, 0.62500054, 0.6666672, 0.7083339, 0.75000054, 0.7916672, 0.8333339, 0.8750006, 0.9166672, 0.9583339, 1.0000006, 1.0416672, 1.0833338, 1.1250006, 1.1666672, 1.208334, 1.2500006, 1.2916672, 1.333334, 1.3750006, 1.4166672, 1.458334, 1.5000006, 1.5416672, 1.583334, 1.6250006, 1.6666672, 1.708334, 1.7500006, 1.7916672, 1.833334, 1.8750006, 1.9166672, 1.958334, 2.0000007, 2.0416672, 2.083334, 2.1250007, 2.1666672, 2.208334, 2.2500007, 2.2916672, 2.333334, 2.3750007, 2.4166672, 2.458334, 2.5000007, 2.5416672, 2.583334, 2.6250007, 2.6666672, 2.708334, 2.7500007, 2.7916672, 2.833334, 2.8750007, 2.9166672, 2.958334, 3.0000007, 3.0416672, 3.083334, 3.1250007, 3.1666672, 3.208334, 3.2500007, 3.2916672, 3.333334, 3.3750007, 3.4166672, 3.458334, 3.5000007, 3.5416672, 3.583334, 3.6250007, 3.6666672, 3.708334, 3.7500007, 3.7916672, 3.833334, 3.8750007, 3.9166672, 3.958334, 4.0000005, 4.0416675, 4.083334, 4.1250005, 4.1666675, 4.208334, 4.2500005, 4.2916675, 4.333334, 4.3750005, 4.4166675, 4.458334, 4.5000005, 4.5416675, 4.583334, 4.6250005, 4.6666675, 4.708334, 4.7500005, 4.7916675, 4.833334, 4.8750005, 4.9166675, 4.958334, 5.0000005, 5.0416675, 5.083334, 5.1250005, 5.1666675, 5.208334, 5.2500005, 5.2916675, 5.333334, 5.3750005, 5.4166675, 5.458334, 5.5000005, 5.5416675, 5.583334, 5.6250005, 5.6666675, 5.708334, 5.7500005, 5.7916675, 5.833334, 5.875001, 5.9166675, 5.958334, 6.000001, 6.0416675, 6.083334, 6.125001, 6.1666675, 6.208334, 6.250001, 6.2916675, 6.333334, 6.375001, 6.4166675, 6.458334, 6.500001, 6.5416675, 6.583334, 6.625001, 6.6666675, 6.708334, 6.750001, 6.7916675, 6.833334, 6.875001, 6.9166675, 6.958334, 7.000001, 7.0416675, 7.083334, 7.125001, 7.1666675, 7.208334, 7.250001, 7.2916675, 7.333334, 7.375001, 7.4166675, 7.458334, 7.500001, 7.5416675, 7.583334, 7.625001, 7.6666675, 7.708334, 7.750001, 7.7916675, 7.833334, 7.875001, 7.9166675, 7.958334, 8.000001, 8.041667, 8.083334, 8.125001, 8.166667, 8.208334, 8.250001, 8.291667, 8.333334, 8.375001, 8.416667, 8.458334, 8.500001, 8.541668, 8.583334, 8.625001, 8.666668, 8.708334, 8.750001, 8.791668, 8.833334, 8.875001, 8.916668, 8.958334, 9.000001, 9.041668, 9.083334, 9.125001, 9.166668, 9.208334, 9.250001, 9.291668, 9.333334, 9.375001, 9.416668, 9.458334, 9.500001, 9.541668, 9.583334, 9.625001, 9.666668, 9.708334, 9.750001, 9.791668, 9.833334, 9.875001, 9.916668, 9.958334, 10.000001, 10.041668, 10.083334, 10.125001, 10.166668, 10.208334, 10.250001, 10.291668, 10.333334, 10.375001, 10.416668, 10.458334, 10.500001, 10.541668, 10.583334, 10.625001, 10.666668, 10.708334, 10.750001, 10.791668, 10.833334, 10.875001, 10.916668, 10.958334, 11.000001, 11.041668, 11.083334, 11.125001, 11.166668, 11.208334, 11.250001, 11.291668, 11.333334, 11.375001, 11.416668, 11.458334, 11.500001, 11.541668, 11.583334, 11.625001, 11.666668, 11.708334, 11.750001, 11.791668, 11.833334, 11.875001, 11.916668, 11.958334, 12.000001, 12.041668, 12.083334, 12.125001, 12.166668, 12.208334, 12.250001, 12.291668, 12.333334, 12.375001, 12.416668, 12.458334, 12.500001, 12.541668, 12.583334, 12.625001, 12.666668, 12.708334, 12.750001, 12.791668, 12.833334, 12.875001, 12.916668, 12.958334, 13.000001, 13.041668, 13.083334, 13.125001, 13.166668, 13.208334, 13.250001, 13.291668, 13.333334, 13.375001, 13.416668, 13.458334, 13.500001, 13.541668, 13.583334, 13.625001, 13.666668, 13.708334, 13.750001, 13.791668, 13.833334, 13.875001, 13.916668, 13.958334, 14.000001, 14.041668, 14.083334, 14.125001, 14.166668, 14.208334, 14.250001, 14.291668, 14.333334, 14.375001, 14.416668, 14.458334, 14.500001, 14.541668, 14.583334, 14.625001, 14.666668, 14.708334, 14.750001, 14.791668, 14.833334, 14.875001, 14.916668, 14.958334, 15.000001, 15.041668, 15.083334, 15.125001, 15.166668, 15.208334, 15.250001, 15.291668, 15.333334, 15.375001, 15.416668, 15.458334, 15.500001, 15.541668, 15.583334, 15.625001, 15.666668, 15.708334, 15.750001, 15.791668, 15.833334, 15.875001, 15.916668, 15.958334, 16.000002, 16.041668, 16.083334, 16.125002, 16.166668, 16.208334, 16.250002, 16.291668, 16.333334, 16.375002, 16.416668, 16.458334, 16.500002, 16.541668, 16.583334, 16.625002, 16.666668, 16.708334, 16.750002, 16.791668, 16.833334, 16.875002, 16.916668, 16.958334, 17.000002, 17.041668, 17.083334, 17.125002, 17.166668, 17.208334, 17.250002, 17.291668, 17.333334, 17.375002, 17.416668, 17.458334, 17.500002, 17.541668, 17.583334, 17.625002, 17.666668, 17.708334, 17.750002, 17.791668, 17.833334, 17.875002, 17.916668, 17.958334, 18.000002, 18.041668, 18.083334, 18.125002, 18.166668, 18.208334, 18.250002, 18.291668, 18.333334, 18.375002, 18.416668, 18.458334, 18.500002, 18.541668, 18.583334, 18.625002, 18.666668, 18.708334, 18.750002, 18.791668, 18.833334, 18.875002, 18.916668, 18.958334, 19.000002, 19.041668, 19.083334, 19.125002, 19.166668, 19.208334, 19.250002, 19.291668, 19.333334, 19.375002, 19.416668, 19.458334, 19.500002, 19.541668, 19.583334, 19.625002, 19.666668, 19.708334, 19.750002, 19.791668, 19.833334, 19.875002, 19.916668, 19.958334, 20.000002, 20.041668, 20.083334, 20.125002, 20.166668, 20.208334, 20.250002, 20.291668, 20.333334, 20.375002, 20.416668, 20.458334, 20.500002, 20.541668, 20.583334, 20.625002, 20.666668, 20.708334, 20.750002, 20.791668, 20.833334, 20.875002, 20.916668, 20.958334, 21.000002, 21.041668, 21.083334, 21.125002, 21.166668, 21.208334, 21.250002, 21.291668, 21.333334, 21.375002, 21.416668, 21.458334, 21.500002, 21.541668, 21.583334, 21.625002, 21.666668, 21.708334, 21.750002, 21.791668, 21.833334, 21.875002, 21.916668, 21.958334, 22.000002, 22.041668, 22.083334, 22.125002, 22.166668, 22.208334, 22.250002, 22.291668, 22.333334, 22.375002, 22.416668, 22.458334, 22.500002, 22.541668, 22.583334, 22.625002, 22.666668, 22.708334, 22.750002, 22.791668, 22.833334, 22.875002, 22.916668, 22.958334, 23.000002, 23.041668, 23.083334, 23.125002, 23.166668, 23.208334, 23.250002, 23.291668, 23.333334, 23.375002, 23.416668, 23.458334, 23.500002, 23.541668, 23.583334, 23.625002, 23.666668, 23.708334, 23.750002, 23.791668, 23.833334, 23.875002, 23.916668, 23.958334, 24.000002, 24.041668, 24.083334, 24.125002, 24.166668, 24.208334, 24.250002, 24.291668, 24.333334, 24.375002, 24.416668, 24.458334, 24.500002, 24.541668, 24.583334, 24.625002, 24.666668, 24.708334, 24.750002, 24.791668, 24.833334, 24.875002, 24.916668, 24.958334, 25.000002, 25.041668, 25.083334, 25.125002, 25.166668, 25.208334, 25.250002, 25.291668, 25.333334, 25.375002, 25.416668, 25.458334, 25.500002, 25.541668, 25.583334, 25.625002, 25.666668, 25.708334, 25.750002, 25.791668, 25.833334, 25.875002, 25.916668, 25.958334, 26.000002, 26.041668, 26.083334, 26.125002, 26.166668, 26.208334, 26.250002, 26.291668, 26.333334, 26.375002, 26.416668, 26.458334, 26.500002, 26.541668, 26.583334, 26.625002, 26.666668, 26.708334, 26.750002, 26.791668, 26.833334, 26.875002, 26.916668, 26.958334, 27.000002, 27.041668, 27.083334, 27.125002, 27.166668, 27.208334, 27.250002, 27.291668, 27.333334, 27.375002, 27.416668, 27.458334, 27.500002, 27.541668, 27.583334, 27.625002, 27.666668, 27.708334, 27.750002, 27.791668, 27.833334, 27.875002, 27.916668, 27.958334, 28.000002, 28.041668, 28.083334, 28.125002, 28.166668, 28.208334, 28.250002, 28.291668, 28.333334, 28.375002, 28.416668, 28.458334, 28.500002, 28.541668, 28.583334, 28.625002, 28.666668, 28.708334, 28.750002, 28.791668, 28.833334, 28.875002, 28.916668, 28.958334, 29.000002, 29.041668, 29.083334, 29.125002, 29.166668, 29.208334, 29.250002, 29.291668, 29.333334, 29.375002, 29.416668, 29.458334, 29.500002, 29.541668, 29.583334, 29.625002, 29.666668, 29.708334, 29.750002, 29.791668, 29.833334, 29.875002, 29.916668, 29.958334, 30.000002, 30.041668, 30.083334, 30.125002, 30.166668, 30.208334, 30.250002, 30.291668, 30.333334, 30.375002, 30.416668, 30.458334, 30.500002, 30.541668, 30.583334, 30.625002, 30.666668, 30.708334, 30.750002, 30.791668, 30.833334, 30.875002, 30.916668, 30.958334, 31.000002, 31.041668, 31.083334, 31.125002, 31.166668, 31.208334, 31.250002, 31.291668, 31.333334, 31.375002, 31.416668, 31.458334, 31.500002, 31.541668, 31.583334, 31.625002, 31.666668, 31.708334, 31.750002, 31.791668, 31.833334, 31.875002, 31.916668, 31.958334, 32.0, 32.041668, 32.083336, 32.125, 32.166668, 32.208336, 32.25, 32.291668, 32.333336, 32.375, 32.416668, 32.458336, 32.5, 32.541668, 32.583336, 32.625, 32.666668, 32.708336, 32.75, 32.791668, 32.833336, 32.875, 32.916668, 32.958336, 33.0, 33.041668, 33.083336, 33.125, 33.166668, 33.208336, 33.25, 33.291668, 33.333336, 33.375, 33.416668, 33.458336, 33.5, 33.541668, 33.583336, 33.625, 33.666668, 33.708336, 33.75, 33.791668, 33.833336, 33.875, 33.916668, 33.958336, 34.0, 34.041668, 34.083336, 34.125, 34.166668, 34.208336, 34.25, 34.291668, 34.333336, 34.375, 34.416668, 34.458336, 34.5, 34.541668, 34.583336, 34.625, 34.666668, 34.708336, 34.75, 34.791668, 34.833336, 34.875, 34.916668, 34.958336, 35.0, 35.041668, 35.083336, 35.125, 35.166668, 35.208336, 35.25, 35.291668, 35.333336, 35.375, 35.416668, 35.458336, 35.5, 35.541668, 35.583336, 35.625, 35.666668, 35.708336, 35.75, 35.791668, 35.833336, 35.875, 35.916668, 35.958336, 36.0, 36.041668, 36.083336, 36.125, 36.166668, 36.208336, 36.25, 36.291668];
                var display_interval = document.getElementById("hourly").checked ? 1 : 720;
                var lat = argMin(lats.map((lat) => Math.abs(lat - event.mapPoint.latitude)));
                var long = argMin(longs.map((long) => Math.abs(long - event.mapPoint.longitude)));
                var hour = Math.round((timeSlider.timeExtent.start.getTime() - 725846400000) / 3600000);
                if (hour < 0) {
                  hour = 0;
                }
                if (hour > 240311 - 48 * display_interval) {
                  hour = 240311 - 48 * display_interval;
                }
                var contents = document.getElementsByClassName("esri-popup__content");
                if (contents.length > 0) {
                  contents[0].innerHTML = "";
                }
                view.popup.close();
                jsdap.loadData("https://asarid:Ecothon2022@my.cmems-du.eu/thredds/dodsC/med-hcmr-wav-rean-h.dods?VHM0[" + hour + ":" + display_interval + ":" + (hour + 48 * display_interval) + "][" + lat + "][" + long + "]", async function(data) {
                  if(data[0][0][0][0] == -32767) {
                    return;
                  }
                  view.popup.visible = true;
                  view.popup.open({
                    // Set the popup's title to the coordinates of the clicked location
                    title: "Trend over 48 " + (document.getElementById("hourly").checked ? "hours" : "months") + " (" + units + ")",
                    location: event.mapPoint, // Set the location of the popup to the clicked location
                    actions: []
                  });
                  while(document.getElementsByClassName("esri-popup__content").length == 0) {
                    await new Promise(r => setTimeout(r, 50));
                  }
                  Plotly.newPlot(document.getElementsByClassName("esri-popup__content")[0], [{
                    x: Array(49).keys(),
                    y: data[0][0].map((val) => add_offset + scale_factor * val[0][0]),
                    type: 'scatter'
                  }], {
                    autosize: false,
                    width: 520,
                    height: 230,
                    margin: {
                      l: 0,
                      r: 0,
                      b: 0,
                      t: 0,
                      pad: 0
                    },
                  });
                  document.getElementsByClassName("modebar")[0].parentElement.innerHTML = "";
                }, "https://api.allorigins.win/raw");
              });
            });
          });
        });
      });
    </script>
  </head>
  <body>
    <div id="viewDiv"></div>
    <div id="timeSlider"></div>
    <span id="layerToggle" class="esri-widget">
      <input type="radio" id="monthly" name="time" checked> Monthly
      <input type="radio" id="hourly" name="time"> Hourly
    </span>
  </body>
</html>